<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Tutor Portfolio</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="/frontend/bootstrap-5.3.3-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>

<body style="background-color: black;">
  <div id="profile-container">
    <div class="profile-box mt-5" style=" width: fit-content;margin: auto;">
      <div class="pic-box border border-5 bg-info border-success overflow-hidden"
        style="width: 250px; height: 250px; border-radius: 50%;">
        <img style="width: 250px; height: 250px; object-fit: cover;" src="" alt="profile-pic">
      </div>
      <div class="tutor-info text-center mt-2">
        <h3 class=" text-primary fw-bold"></h3>
        <h5 class="fw-bold text-light"></h5>
        <h5 class="fw-bold text-light"></h5>
      </div>
    </div>

    <div class="subject-address mt-5 gap-5">
      <div class="profile-div rounded d-flex flex-wrap justify-content-center gap-5 p-4 pt-5 pb-5"
        style="width: 1000px; margin: auto; background-color:rgb(1, 14, 22); box-shadow: 4px 4px 8px rgb(4, 157, 177);">
        <div class="sub-address-left border border-2 p-3 rounded-3 text-center"
          style="width: 450px; background-color: rgb(168, 190, 152); box-shadow: 6px 6px 5px goldenrod;">
          <h5>Subjects to Teach:</h5>
          <h5 style="color: rgb(33, 6, 141);"></h5>
          <h5 class="mt-4">Available Time:</h5>
          <h5 style="color: rgb(33, 6, 141);"></h5>
        </div>

        <div class="sub-address-right border border-1 p-3 rounded-3 text-center"
          style="width: 450px;background-color: rgb(168, 190, 152); box-shadow: 6px 6px 5px goldenrod;">
          <h5>Current Address:</h5>
          <h5 style="color: rgb(33, 6, 141);"></h5>
          <h5 class="mt-4">Tutor's Email:</h5>
          <h5 style="color: rgb(33, 6, 141);"></h5>
        </div>
      </div>
    </div>

    <div class="tutor-id-card rounded-4 p-3"
      style="width: 450px; background-color: rgb(2, 42, 71); margin: auto; box-shadow: 4px 4px 8px goldenrod; margin-top: 100px;">
      <h4 class="fw-bold text-light mb-2 text-center" style="text-shadow: 2px 2px 5px rgb(103, 224, 4);">Student ID:
      </h4>
      <div class="id-photo rounded mt-3" style="width: 350px; margin: auto;">
        <img class="img-fluid" id="idPhoto" src="" alt="ID Photo">
      </div>
    </div>

    <div class="whatsapp-box d-flex justify-content-center" style="width: 600px; margin: auto; box-shadow: 3px 3px 8px rgb(18, 42, 227); background-color: rgb(8, 1, 29); margin-top: 80px;">
      <div class="direct-contact m-4 p-4 rounded-3 text-bold text-center"
        style="width: 500px; background-color: rgb(19, 24, 68); margin: auto;">
        <h6 class="text-light"><b>To contact directly with Tutor:</b></h6>
        <button class="p-2 mt-3" id="whatsappBtn" style="background-color: rgb(28, 233, 38); "><i
            class="fab fa-whatsapp me-2"></i><b>WhatsApp Contact Number</b></button>
      </div>
    </div>
    <div class="video-upload p-3" style="box-shadow:2px 2px 2px 3px rgb(117, 129, 2); width: 600px; height: 350px; margin: auto; margin-top: 80px;"  >
      
    </div>
    <div class="about-me rounded mt-5 mb-5 p-3 text-center"
      style="width: 720px; background-color: rgb(5, 45, 32); margin: auto;">
      <h3><u class="text-light">About Me</u></h3>
      <h5 class="mt-3 text-light"></h5>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    fetch(`/api/profiles/${id}`)
      .then(res => res.json())
      .then(p => {

        document.querySelector(".pic-box img").src = `/uploads/${p.photo}` || "/uploads/bg-1.jpg";
        document.querySelector(".tutor-info h3").textContent = p.full_name;
        document.querySelector(".tutor-info h5:nth-of-type(1)").textContent = `Department: ${p.department}`;
        document.querySelector(".tutor-info h5:nth-of-type(2)").innerHTML = `Available: ${p.available}`;
        document.querySelector(".sub-address-left h5:nth-of-type(2)").innerHTML = `<strong>${p.subject_to_teach}</strong>`;
        document.querySelector(".sub-address-left h5:nth-of-type(4)").innerHTML = `<strong>${p.available_time}</strong>`;
        document.querySelector(".sub-address-right h5:nth-of-type(2)").innerHTML = `<strong>${p.address}</strong>`;
        document.querySelector(".sub-address-right h5:nth-of-type(4)").innerHTML = `<strong>${p.email}</strong>`;
        document.querySelector(".id-photo img").src = `/uploads/${p.id_photo}` || "/uploads/defaultID.jpeg";
        document.querySelector(".about-me h5:nth-of-type(1)").innerHTML = p.about_me;

        function getYouTubeEmbed(url) {
          const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]{6,})/);
          return ytMatch ? `https://www.youtube.com/embed/${ytMatch[1]}` : null;
        }

        function getDrivePreview(url) {
          const idMatch = url.match(/\/d\/([A-Za-z0-9_-]{10,})/);
          if (idMatch) return `https://drive.google.com/file/d/${idMatch[1]}/preview`;
          const qMatch = url.match(/[?&]id=([A-Za-z0-9_-]{10,})/);
          if (qMatch) return `https://drive.google.com/file/d/${qMatch[1]}/preview`;
          return null;
        }

        //determine embed html
        let embedHtml = "";
        if (p.intro_video_link) {
          const link = p.intro_video_link.trim();
          const yt = getYouTubeEmbed(link);
          const dr = getDrivePreview(link);
          if (yt) {
            embedHtml = `<div class="video-embed text-center" >
                     <iframe width="560" height="315" src="${yt}" frameborder="0" allowfullscreen></iframe>
                   </div>`;
          } else if (dr) {
            embedHtml = `<div class="video-embed text-center">
                     <iframe width="560" height="315" src="${dr}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                   </div>`;
          } else {
            embedHtml = `<div class="video-embed text-center" >
                  <iframe width="560" height="315" src="${dr}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                   <a href="${p.intro_video_link}" target="_blank">Open Intro Video</a>
                 </div>`;
          }
        }
        document.querySelector(".video-upload ").innerHTML = embedHtml;

        const waBtn = document.getElementById("whatsappBtn");
        if (p.whatsapp_number) {
          waBtn.onclick = () => {
            const phone = p.whatsapp_number.replace(/\D/g, '');
            window.open(`https://wa.me/${phone}`, "_blank");
          };
        } else {
          waBtn.style.display = "none";
        }
      });


  </script>
  <script src="/frontend/bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>