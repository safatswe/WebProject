<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Tutor Portfolio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="/frontend/bootstrap-5.3.3-dist/css/bootstrap.min.css">
</head>

<body style="background-image: url('/uploads/bg-3.jpg');background-size: cover;">
    <div id="profile-container">
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        fetch(`/api/profiles/${id}`)
            .then(res => res.json())
           .then(p => {
  const container = document.getElementById("profile-container");
  container.innerHTML = "";
  const div = document.createElement("div");
  div.className = "profile-interface";

  // helper functions to build embed url
  function getYouTubeEmbed(url) {
    const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]{6,})/);
    return ytMatch ? `https://www.youtube.com/embed/${ytMatch[1]}` : null;
  }

  function getDrivePreview(url) {
    const idMatch = url.match(/\/d\/([A-Za-z0-9_-]{10,})/);
    if (idMatch) return `https://drive.google.com/file/d/${idMatch[1]}/preview`;
    const qMatch = url.match(/[?&]id=([A-Za-z0-9_-]{10,})/);
    if (qMatch) return `https://drive.google.com/file/d/${qMatch[1]}/preview`;
    return null;
  }

  // determine embed html
  let embedHtml = "";
  if (p.intro_video_link) {
    const link = p.intro_video_link.trim();
    const yt = getYouTubeEmbed(link);
    const dr = getDrivePreview(link);
    if (yt) {
      embedHtml = `<div class="video-embed mt-4 text-center">
                     <iframe width="560" height="315" src="${yt}" frameborder="0" allowfullscreen></iframe>
                   </div>`;
    } else if (dr) {
      embedHtml = `<div class="video-embed mt-4 text-center">
                     <iframe width="560" height="315" src="${dr}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                   </div>`;
    } else {
      embedHtml = `<div class="mt-3 text-center">
                     <a href="${p.intro_video_link}" target="_blank">Open Intro Video</a>
                   </div>`;
    }
  }

  div.innerHTML = `
    <div class="profile-box d-flex flex-wrap justify-content-center gap-3 mt-5">
      <div class="pic-box border border-5 bg-info border-success overflow-hidden" style="width: 250px; height: 250px; border-radius: 50%;">
        <img style="width: 250px; height: 250px; object-fit: cover;" src="/uploads/${p.photo}" alt="profile-pic">
      </div>
      <div class="tutor-info text-start" style="margin-top: 100px;">
        <h3 class=" text-primary fw-bold">${p.full_name}</h3>
        <h5 class="fw-bold">Department: ${p.department}</h5>
        <h5 class="fw-bold">Available: ${p.available}</h5>
      </div>
    </div>

    <div class="subject-address mt-5 d-flex flex-wrap justify-content-center gap-5">
      <div class="sub-address-left border border-2 p-2 rounded-3 text-center" style="width: 450px; background-color: rgb(188, 235, 59);">
        <h5>Teaching Subjects:</h5>
        <h6><b>${p.subject_to_teach}</b></h6>
        <h5>Available Time:</h5>
        <h6><b>${p.available_time}</b></h6>
      </div>
      <div class="sub-address-right border border-2 p-2 rounded-3 text-center" style="width: 450px; background-color: rgb(188, 235, 59); ">
        <h5>Address:</h5>
        <h6><b>${p.address}</b></h6>
        <h5>Email:</h5>
        <h6><b>${p.email}</b></h6>
      </div>
    </div>

    <div class="tutor-id-card border box-shadow rounded-4 p-2 mt-5" style="width: 400px; background-color: rgb(136, 181, 213); margin: auto;">
      <h4 class="fw-bold text-dark text-center">Tutor's ID Card</h4>
      <div class="id-photo" style="width: 350px; margin: auto;">
        <img class="img-fluid" id="idPhoto" src="/uploads/${p.id_photo}" alt="ID Photo">
      </div>
    </div>

    <div class="direct-contact border border-2 mt-5 p-4 rounded-3 text-bold text-center" style="width: 500px; background-color: rgb(243, 170, 75); margin: auto;">
      <h6>To contact directly to tutor: Click the link</h6>
      <button class="p-2" id="whatsappBtn" style="background-color: rgb(28, 233, 38); "><i class="fab fa-whatsapp me-2"></i><b>Message on WhatsApp</b></button>
    </div>

    ${embedHtml}

    <div class="about-me border border-2 rounded mt-5 mb-5 p-3 text-center" style="width: 800px; background-color: rgb(181, 148, 235); margin: auto;">
      <h4 class="mt-3 fw-bold">About Me</h4>
      <p class="text-start p-2">${p.about_me}</p>
    </div>
  `;

  container.appendChild(div);

  const waBtn = document.getElementById("whatsappBtn");
  if (p.whatsapp_number) {
    waBtn.onclick = () => {
      const phone = p.whatsapp_number.replace(/\D/g, '');
      window.open(`https://wa.me/${phone}`, "_blank");
    };
  } else {
    waBtn.style.display = "none";
  }
});

    </script>
    <script src="/frontend/bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>


</body>

</html>